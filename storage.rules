rules_version = '2';

service firebase.storage {
  // Default bucket for user-uploaded content like profile photos
  match /b/mouth-metrics-flutter-app.appspot.com/o {
    match /user-photos/{userId}/{photoId} {
      allow read;
      allow write: if request.auth != null
                    && request.auth.uid == userId
                    && request.resource.size < 2 * 1024 * 1024 // 2MB
                    && request.resource.contentType.matches('image/(png|jpeg)');
    }
  }

  // Bucket for statically generated user profile pages
  match /b/user-profile-pages/o {
    match /{allPaths=**} {
      allow read;
      allow write: if false; // Only backend/functions can write
    }
  }

  // Bucket for statically generated business profile pages
  match /b/business-profile-pages/o {
    match /{allPaths=**} {
      allow read;
      allow write: if false; // Only backend/functions can write
    }
  }

  // Bucket for statically generated published articles
  match /b/published-articles/o {
    match /{allPaths=**} {
      allow read;
      allow write: if false; // Only backend/functions can write
    }
  }
}
